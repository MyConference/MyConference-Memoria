\chapter{Servicio Web y Base de Datos}
\label{chap:webservice}

\begin{figure}[h]
  \centering
  \includegraphics[width=0.75\textwidth]{./Imagenes/Bitmap/diagrama-api-web-db}
  \caption{Diagrama de la arquitectura relevante al Servicio Web}
  \label{fig:diagram-webserv}
\end{figure}

En este capítulo describiremos los servicios web disponibles en MyConference.
En un primer lugar hablaremos del centro neurálgico de MyConference, la API, encargada de la gestión y supervisión de los datos.
Posteriormente hablaremos de la base de datos que almacena toda la información de MyConference.
Por último, hablaremos del formulario web que permite a los usuarios introducir datos en el sistema.

La figura \ref{fig:diagram-webserv} muestra la parte relevante del sistema que se explicará en este capítulo, de acuerdo con la arquitectura general de MyConference.

\section{API}

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\textwidth]{./Imagenes/Bitmap/diagrama-api}
  \caption{Diagrama de la arquitectura relevante a la API}
  \label{fig:diagram-api}
\end{figure}

La API (Application Programing Interface) es un servicio HTTP que regula el acceso a todos los datos de MyConference. Es el único punto de toda la infraestructura que tiene acceso a la base de datos y es la única parte que no tiene una utilidad directa para el usuario.

El resto de aplicaciones de MyConference (Web, Android) son interfaces de usuario que realizan \textit{llamadas} (peticiones HTTP) a la API, identificándose a sí mismas como aplicaciones de la plataforma e identificando al usuario a través de sus credenciales (e-mail, contraseña).

La API está implementada en su totalidad utilizando Node.js (Véase \ref{tech:nodejs}) con una serie de bibliotecas que facilitan la implementación en general o en ciertas áreas en particular.

En la figura \ref{fig:diagram-api} podemos ver cómo está ubicada la API dentro de la arquitectura general del sistema.

\subsection{Servidor Web}

Puesto que se trata de una API completamente web y Node.js es un simple entorno de ejecución JavaScript, el servidor web está programado directamente en la aplicación.
Afortunadamente, Node.js cuenta con una biblioteca estándar que incluye soporte para servidores HTTP, y en su repositorio de paquetes hay un gran número de bibliotecas para facilitar el desarrollo.

Para escribir APIs web, concretamente, existe \texttt{restify}, un pequeño framework pensado para este tipo de servidores.
Mediante esta librería, dividimos toda la implementación en \textit{rutas}, pequeñas definiciones de funciones que responderán a una petición a una ruta HTTP concreta.

A su vez, estas funciones, en su mayoría, realizarán una o varias llamadas a la base de datos.
Para trabajar con ella se utilizan una serie de \textit{modelos} implementados mediante \texttt{mongoose}, una biblioteca para dar forma a las colecciones de MongoDB como modelos y poder trabajar directamente con estos modelos.

\subsection{Acceso}

El acceso a los datos, así como su modificación, se realiza mediante peticiones HTTP.

Todos los datos se envían y reciben en formato JSON. Cualquier otro formato pedido (mediante la cabecera \texttt{Accept}) o enviado (mediante \texttt{Content-Type}) será rechazado por el servidor. Esto simplifica el código de la API, puesto que JSON es un formato de representación nativo de JavaScript, el lenguaje en el que está implementada.

Para acceder a los datos es necesario disponer de un testigo de acceso, cuya obtención veremos más adelante en la sección \ref{sec:api-auth}. Para enviar este testigo usaremos la cabecera HTTP \texttt{Authorization}, con el valor \texttt{Token~\textit{token-string}} (donde \textit{token-string} es el valor del testigo del que disponemos).

Los datos de la aplicación están divididos en \textit{entidades}, que representan colecciones de datos similares. Para cada entidad disponemos, en general, de las siguientes acciones:

\begin{itemize}
  \item Ver en detalle un elemento, mediante una petición \texttt{GET /entidad/id}. Se obtiene una lista con los atributos del elemento y los elementos relacionados.
  \item Crear un nuevo elemento de un tipo, mediante una petición \texttt{POST /entidad}. Se deben enviar los atributos iniciales del elemento.
  %\item Modificar un elemento existente, mediante una petición \texttt{PUT /entidad/id}. Se deben enviar los nuevos atributos del objeto.
  \item Eliminar un elemento existente, mediante una petición \texttt{DELETE /entidad/id}. Se obtiene una confirmación.
\end{itemize}

Las entidades pueden proporcionar otras acciones en determinadas circunstancias, como se describe en el apartado \nameref{sect:api-docs}.

De la misma manera, todas las peticiones utilizan los códigos HTTP estándar, entre ellos:

\begin{itemize}
  \item \texttt{401~Unauthorized} para errores de autenticación.
  \item \texttt{403~Forbidden} para operaciones para las que el usuario no tiene permiso.
  \item \texttt{404~Not~Found} para elementos no existentes.
  \item \texttt{500~Internal~Server~Error} para problemas internos de la API.
\end{itemize}


\subsection{Autenticación}
\label{sec:api-auth}

Todos los servicios que ofrece la API de MyConference están protegidos.
El sistema de autenticación funciona siguiendo un esquema similar al de los estándares OAuth y OpenID.
Para acceder a los servicios que ofrece la API de MyConference es necesario obtener un \textit{testigo de acceso}, que irá unido a un usuario y se enviará en cada petición en una cabecera HTTP.

Para obtener un testigo de acceso se debe realizar una petición a una ruta específica (\texttt{/auth}) de la API, indicando lo siguiente:

\begin{itemize}
  \item Qué aplicación se está usando para realizar la petición (Identificada mediante un UUID).
  \item Qué dispositivo está realizando la petición (Cadena de texto arbitraria, permite diferenciar diferentes sesiones del mismo usuario mediante la misma aplicación).
  \item Las credenciales de acceso a la aplicación.
\end{itemize}

Existen múltiples tipos de credenciales de acceso, detallados más adelante. Si todos los datos son correctos, ocurrirá lo siguiente:

\begin{itemize}
  \item Se crea un nuevo testigo de acceso asociado al usuario cuyas credenciales coinciden.
  \item Se crea un nuevo testigo de actualización asociado al nuevo testigo de acceso.
  \item Se invalidan todos los testigos de acceso y de actualización anteriores que fueran generados usando la misma aplicación y el mismo dispositivo.
  \item Se devuelven ambos testigos, sus fechas de caducidad y el identificador del usuario identificado.
\end{itemize}

El \textit{testigo de actualización} devuelto tiene como función generar un nuevo testigo de acceso en caso de que este caduque. Los testigos de acceso tienen un tiempo de uso de unos pocos días, mientras que los testigos de actualización duran semanas. Esto minimiza la posibilidad de uso de un testigo de acceso interceptado por una tercera parte.

Para que un intento de autenticación tenga éxito, las credenciales usadas deben coincidir con algunas credenciales almacenadas en la base de datos. Los siguientes son los tipos de credenciales que se definen:

\begin{itemize}
  \item \textbf{Usuario y contraseña}: Utilizamos un nombre de usuario (correo electrónico) y contraseña registrados previamente para realizar la autenticación.
  \item \textbf{Testigo de Actualización}: Se utiliza un testigo de actualización para realizar la autenticación. La aplicación y el dispositivo con los que se generó el testigo usado deben coincidir con los datos de la petición.
  \item \textbf{Testigo de Autorización}: Se utiliza un testigo de autorización obtenido mediante otros medios para realizar la autenticación. La aplicación y el dispositivo con los que se generó el testigo usado deben coincidir con los datos de la petición.
\end{itemize}

Los testigos de autorización existen para realizar accesos mediante servicios externos, actualmente no implementados. 

% =========================================================================== %

\subsection{Servicios Disponibles}
\label{sect:api-docs}

\begin{samepage}
A continuación se describen todos los servicios de la API disponibles, con el siguiente formato:

\paragraph{Título del Servicio (\texttt{VERBO /ruta/al/servicio})} ~\\
\end{samepage}

En caso de hacer falta algún parámetro en la URL, se mostrará rodeado con corchetes angulares, \texttt{<así>}.
Si hacen falta parámetros en el cuerpo (en formato JSON), se especificarán en forma de lista:

\begin{itemize}
  \item \texttt{argumento}: Descripción del argumento 
\end{itemize}

Salvo que se indique lo contrario, todas las llamadas requieren del envío de un testigo de acceso válido.
Para ello se utilizará la cabecera HTTP \texttt{Authorization} con el valor \texttt{Token \textit{abcdef}}, donde \textit{abcdef} es el testigo de acceso.

Se mostrará a su vez una descripción del servicio, así como de los posibles errores que se pudieran dar en cada uno.

% =========================================================================== %

\subsubsection{Autenticación y Registro}

% =========================================================================== %

\paragraph{Registro (\texttt{POST /auth/signup})}

\begin{itemize}
  \item \texttt{application\_id}: ID de aplicación desde la que se realiza la petición.
  \item \texttt{device\_id}: ID del dispositivo desde el que se realiza la petición. 
  \item \texttt{user\_data}: Un objeto JSON con los campos:
  \begin{itemize}
    \item \texttt{email}: Correo electrónico del usuario a registrar.
    \item \texttt{password}: Contraseña del usuario a registrar.
  \end{itemize}
\end{itemize}

La figura \ref{fig:regist-seq} muestra el proceso de registro sin errores.

\begin{figure}[h]
  \begin{center}
    \includegraphics[width=.8\textwidth]{Imagenes/Bitmap/API/SeqDiagRegister}
    \caption{Diagrama del Proceso de Registro}
    \label{fig:regist-seq}
  \end{center}
\end{figure}

El registro no necesita testigo de acceso, puesto que es un proceso previo a la obtención de éste.
Los datos de usuario provistos en el cuerpo de la petición se integrarán en el sistema y se creará un nuevo usuario que podrá posteriormente identificarse con ellos.

El correo electrónico ha de ser válido y la contraseña ha de tener al menos 8 caracteres.
No existen más restricciones en la contraseña, ni en contenido ni en longitud.

% =========================================================================== %

\newpage
\paragraph{Autenticación (\texttt{POST /auth})}

\begin{itemize}
  \item \texttt{application\_id}: ID de aplicación desde la que se realiza la petición.
  \item \texttt{device\_id}: ID del dispositivo desde el que se realiza la petición. 
  \item \texttt{credentials}: Un objeto JSON con los campos:
  \begin{itemize}
    \item \texttt{type}: Tipo de credenciales a utilizar.
    El resto de campos en este objeto dependerán exclusivamente del tipo de credenciales que se estén usando.
    Este campo admite credenciales de tipo \texttt{password} y \texttt{refresh}.

    \item \texttt{email}: (si \texttt{type} es \texttt{password}) E-mail del usuario a identificar.
    \item \texttt{password}: (si \texttt{type} es \texttt{password}) Contraseña del usuario a identificar.

    \item \texttt{refresh\_token}: (si \texttt{type} es \texttt{refresh}) Testigo de actualización de un usuario ya identificado previamente.
    
  \end{itemize}
\end{itemize}

La figura \ref{fig:auth-seq} muestra el proceso de autenticación sin errores.

\begin{figure}[h]
  \begin{center}
    \includegraphics[width=.8\textwidth]{Imagenes/Bitmap/API/SeqDiagAuth}
    \caption{Diagrama del Proceso de Autenticación}
    \label{fig:auth-seq}
  \end{center}
\end{figure}

Esta llamada no necesita testigo de acceso, puesto que es precisamente con ella como podemos conseguir uno.

El campo \texttt{device\_id} es libre y puede contener cualquier cosa, pero está presente para posibilitar que un mismo usuario abra múltiples sesiones en la misma aplicación, por ejemplo, en varios PCs o dispositivos Android. Este valor debería ser tan único como fuera posible, por lo que, aunque no es un requisito, se recomienda usar un UUID o algún esquema similar. Además, si estamos realizando una llamada con credenciales de tipo \texttt{refresh}, este campo ha de coincidir con el de la llamada que generó dicho testigo de actualización originalmente.

El resultado de una llamada válida a este servicio será un objeto JSON con los siguientes campos:

\begin{itemize}
  \item \texttt{access\_token}: Nuevo token de acceso para la aplicación.
  \item \texttt{access\_expires}: Fecha de caducidad del testigo de acceso (en formato ISO).
  \item \texttt{refresh\_token}: Nuevo token de actualización para la aplicación.
  \item \texttt{refresh\_expires}: Fecha de caducidad del testigo de actualización (en formato ISO).
  \item \texttt{user}: Información del usuario con el que acabamos de iniciar sesión, como los campos:
  \begin{itemize}
    \item \texttt{id}: Identificador del usuario.
    \item \texttt{url}: Ruta completa a la que realizar una llamada para obtener toda la información del usuario.
  \end{itemize}
\end{itemize}

% =========================================================================== %

\paragraph{Desautorización (\texttt{POST /auth/logout})} ~\\

Este servicio no necesita datos extra. Tras realizar esta llamada, el testigo de acceso y su testigo de actualización asociado serán deshabilitados, desautorizando al usuario de todo acceso con dichos testigos.

Este servicio está pensado para utilizarse por las aplicaciones para implementar el ``cierre de sesión'' característico de cualquier aplicación o servicio web de una forma segura que no engañe al usuario, que realmente desautorice el acceso en lugar de simplemente olvidarlo y dejarlo caducar.

% =========================================================================== %

\subsubsection{Usuarios y Congresos}

\paragraph{Datos de usuario (\texttt{GET /users/<user-id>})} ~\\

Devuelve la información del usuario indicado en \texttt{user-id} como un objeto JSON con los siguientes campos:

\begin{itemize}
  \item \texttt{id}: Identificador del usuario.
  \item \texttt{url}: Ruta completa del usuario en la API.
  \item \texttt{conferences}: Un array JSON con objetos JSON con los siguientes campos.
  \begin{itemize}
    \item \texttt{id}: Identificador del congreso.
    \item \texttt{url}: Ruta completa del congreso en la API.
    \item \texttt{role}: Rol del usuario en el congreso (\texttt{owner}, \texttt{assistant})
  \end{itemize}
\end{itemize}

% =========================================================================== %

\paragraph{Congresos del usuario (\texttt{GET /users/<user-id>/conferences})} ~\\

Devuelve la lista de congresos del usuario indicado en \texttt{user-id} como una lista de objetos JSON con los siguientes campos:

\begin{itemize}
  \item \texttt{id}: Identificador del congreso.
  \item \texttt{url}: Ruta completa del congreso en la API.
  \item \texttt{name}: Nombre del congreso.
  \item \texttt{description}: Descripción completa del congreso.
  \item \texttt{role}: Rol del usuario en el congreso (\texttt{owner}, \texttt{assistant})
\end{itemize}

% =========================================================================== %

\paragraph{Información de Congreso (\texttt{GET /conferences/<conference-id>})} ~\\

Devuelve la información del congreso indicado en \texttt{conference-id} como un objeto JSON con los siguientes campos:

\begin{itemize}
  \item \texttt{id}: Identificador del congreso.
  \item \texttt{url}: Ruta completa del congreso en la API.
  \item \texttt{name}: Nombre del congreso.
  \item \texttt{description}: Descripción completa del congreso.
  \item \texttt{documents}: Array JSON con los documentos (enlaces) del congreso.
  \item \texttt{venues}: Array JSON con los lugares del congreso.
  \item \texttt{announcements}: Array JSON con los anuncios del congreso.
  \item \texttt{organizers}: Array JSON con los organizadores del congreso.
  \item \texttt{speakers}: Array JSON con los ponentes del congreso.
  \item \texttt{agendaEvents}: Array JSON con los eventos del programa del congreso.
  \item \texttt{usuarios}: Array JSON con los usuarios asistentes al congreso.
\end{itemize}

El contenido exacto de los objetos de cada uno de los arrays se especificará más adelante.

% =========================================================================== %

\paragraph{Creación de Congresos (\texttt{POST /conferences})} ~\\

\begin{itemize}
  \item \texttt{name}: Nombre del congreso.
  \item \texttt{description}: Descripción completa del congreso.
\end{itemize}

Crea un nuevo congreso y añade al usuario identificado como único propietario del mismo.

% =========================================================================== %

\paragraph{Eliminación de Congresos (\texttt{DELETE /conferences/<conference-id>})} ~\\

Elimina completamente el congreso indicado en \texttt{conference-id} y todos los datos relacionados con él, de forma irreversible.

Para que esta llamada tenga efecto, el usuario debe der propietario del congreso.

% =========================================================================== %

\subsubsection{Entidades del Congreso}

Los congresos tienen una serie de entidades directamente dependientes de estos (documentos, ponentes, organizadores, etc.) que se manejan igual unos con respecto a otros. Por este motivo, describiremos primero las entidades y sus campos por separado y, posteriormente, las acciones que podemos realizar sobre ellas.

Todas las entidades tienen los siguientes campos en común:

\begin{itemize}
  \item \texttt{id}: Identificador del objeto.
  \item \texttt{url}: Ruta completa del objeto en la API.
  \item \texttt{conference}: Información del congreso al que pertenece este objeto.
  Dependiendo de si el objeto forma parte de una lista o se ha obtenido individualmente, habrá más o menos campos, pero podemos contar con los campos \texttt{id} y \texttt{url} del congreso.
\end{itemize}

Las entidades disponibles y sus campos son las siguientes (El nombre de la entidad en plural, tal como se escribiría en la ruta del servicio):

\begin{description}
  \item[\texttt{agenda-events}] Programa del congreso, en forma de \textit{eventos}.
  \begin{description}
    \item[\texttt{title}] Título del evento.
    \item[\texttt{description}] Descripción del evento.
    \item[\texttt{date}] Fecha y hora del evento, en formato ISO.
  \end{description}

  \item[\texttt{announcements}] Novedades del congreso, siempre ordenadas en orden cronológico inverso (del más reciente al más antiguo).
  \begin{description}
    \item[\texttt{title}] Título del anuncio.
    \item[\texttt{body}] cuerpo del anuncio.
    \item[\texttt{date}] Fecha y hora del anuncio, en formato ISO.
  \end{description}

  \item[\texttt{documents}] Enlaces a documentos del congreso, como carteles, \textit{call for papers}, webs oficiales...
  \begin{description}
    \item[\texttt{title}] Título del documento.
    \item[\texttt{description}] Descripción del documento.
    \item[\texttt{type}] Tipo de documento. Sólo se admite \texttt{link}.
    \item[\texttt{data}] URL del documento.
  \end{description}

  \item[\texttt{organizers}] Miembros del comité organizador del congreso.
  \begin{description}
    \item[\texttt{name}] Nombre del organizador.
    \item[\texttt{origin}] Procedencia del organizador.
    \item[\texttt{details}] Detalles del organizador.
    \item[\texttt{group}] Grupo o categoría en la que incluir al organizador.
  \end{description}
  
  \item[\texttt{speakers}] Ponentes del congreso.
  \begin{description}
    \item[\texttt{name}] Nombre del ponente.
    \item[\texttt{charge}] Cargo del ponente.
    \item[\texttt{description}] Detalles del ponente.
    \item[\texttt{picture\_url}] URL de la foto del ponente.
  \end{description}
  
  \item[\texttt{venues}] Lugares importantes del congreso, como el recinto en el que se celebra.
  \begin{description}
    \item[\texttt{name}] Nombre del lugar.
    \item[\texttt{details}] Detalles del lugar.
    \item[\texttt{location}] Objeto JSON con dos campos, \texttt{lat} y \texttt{lng}, indicando la latitud y longitud del lugar.
  \end{description}
\end{description}

La forma de listar todos los elementos de una entidad para una conferencia es obtener la información de dicha conferencia. No existen servicios de listado por entidades.

% =========================================================================== %

\paragraph{Información de Entidades (\texttt{GET /<entity>/<id>})} ~\\

Obtiene toda la información del elemento \texttt{id} de la entidad \texttt{entity}.
El resultado es un objeto JSON con los campos descritos para la entidad.

% =========================================================================== %

\paragraph{Creación de Entidades (\texttt{POST /<entity>})} ~\\

Crea un nuevo elemento de la entidad \texttt{entity}.
Además de los campos descritos para la entidad con la información del objeto, se ha de incluir un campo \texttt{conference} con el identificador del congreso al que pertenecerá.
El usuario ha de ser propietario de este congreso para poder añadir un elemento en él.

% =========================================================================== %

\paragraph{Eliminación de Entidades (\texttt{DELETE /<entity>/<id>})} ~\\

Elimina el elemento \texttt{id} de la entidad \texttt{entity}.
Para que este servicio funcione correctamente, el usuario debe ser propietario del congreso al que pertenece el objeto.

% =========================================================================== %

\subsubsection{Códigos de Invitación}

Para poder añadir a otros usuarios a un congreso, hay que invitarlos mediante correo electrónico.
Para ello se dan los siguientes servicios en la API

% =========================================================================== %

\paragraph{Invitar a un Usuario (\texttt{POST /invite-codes})}

\begin{itemize}
  \item \texttt{recipient\_email}: Correo electrónico al que enviar la invitación.
  No tiene por qué estar registrado en MyConference ni ser el mismo que el del usuario que lo acepta.
  \item \texttt{recipient\_name}: Nombre completo del usuario al que invitar.
  \item \texttt{conference}: Identificador del congreso al que invitar al usuario.
  El usuario actual ha de ser propietario de este congreso.
\end{itemize}

Envía un correo electrónico con un enlace a la web y un código para introducir en dicho enlace a la dirección indicada.


% =========================================================================== %

\paragraph{Utilizar un Código de Invitación (\texttt{POST /invite-codes/<code>/redeem})}

Esta llamada no necesita ningún parámetro.
Al finalizar esta llamada el usuario se añadirá a la lista de asistentes del congreso al que pertenece el código de invitación.

% =========================================================================== %

\section{Base de Datos}

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\textwidth]{./Imagenes/Bitmap/diagrama-db}
  \caption{Diagrama de la arquitectura relevante a la Base de Datos}
  \label{fig:diagram-db}
\end{figure}

La base de datos (MongoDB) está estructurada en colecciones. Cada colección representa una \textit{entidad} de MyConference. Estas entidades se pueden distinguir en \textit{entidades fundamentales}, aquellas que aportan los datos básicos del sistema, y \textit{entidades de apoyo}, aquellas necesarias para el correcto funcionamiento de la aplicación pero que el usuario no percibe.

En la figura \ref{fig:diagram-db} puede verse la base de datos dentro de la arquitectura general de Myconference. En particular, nótese que la base de datos únicamente interactúa con la API. Ningún otro componente del sistema tiene acceso directo a la base de datos por motivos de seguridad.

\subsection{Entidades Fundamentales}

%\textit{Futuro gráfico entidad-relación con toda la "jerarquía" de entidades}

No se describirán los campos concretos de estas entidades, puesto que son idénticos a los descritos en la sección \ref{sect:api-docs}.

\begin{description}

  \item[\texttt{Conference}]
  El centro de MyConference, representa un congreso.

  \item[\texttt{User}]
  Representa un usuario registrado en MyConference.
  Nótese que esta entidad no posee información sobre el inicio de sesión del usuario.

  \item[\texttt{AgendaEvent}]
  Represetna un evento dentro del programa de un congreso.

  \item[\texttt{Announcement}]
  Representa un anuncio (novedad) dentro de un congreso.

  \item[\texttt{Document}]
  Representa un enlace a un documento del congreso.

  \item[\texttt{Organizer}]
  Representa un miembro del comité organizador.

  \item[\texttt{Speaker}]
  Representa un ponente del congreso.

  \item[\texttt{Venue}]
  Representa un lugar del congreso.

\end{description}

\subsection{Entidades de Apoyo}

%\textit{Futuro gráfico entidad-relación con las entidades de apoyo (tokens, loginmethods)}

Existen otras entidades en la base de datos que aportan funcionalidad pero no representan datos de negocio.
Estas aportan a la aplicación información sobre autenticación, principalmente.

\begin{description}

  \item[\texttt{LoginMethod}]
  Representa un método de identificación de un usuario.
  El único tipo de identificación disponible es \texttt{password}, que utilizará un correo electrónico y una contraseña para la identificación.

  \item[\texttt{Application}]
  Representa una aplicación oficial de MyConference.
  El ID de la aplicación se podrá utilizar para registrar nuevos usuarios o autenticar usuarios existentes.

  \item[\texttt{AccessToken}]
  Representa un testigo de acceso a la API, que deberá usarse para acceder a los datos.

  \item[\texttt{RefreshToken}]
  Representa un testigo de actualización, que podrá usarse para obtener un nuevo testigo de acceso sin volver a identificar al usuario.

  \item[\texttt{InviteCode}]
  Representa un código de invitación enviado a un usuario para unirse a un congreso.

\end{description}

\section{Web}
\label{chap:web}

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\textwidth]{./Imagenes/Bitmap/diagrama-web}
  \caption{Diagrama de la arquitectura relevante a la Web}
  \label{fig:diagram-web}
\end{figure}

La Web es la encargada de la gestión de los congresos de MyConference. Desde la aplicación Web se crean los nuevos congresos y se añade toda la información correspondiente a estos. Aunque también se pueden visualizar los datos creados desde la Web, su función principal es la creación y borrado de datos de los congresos.

La figura \ref{fig:diagram-web} muestra la web dentro de la arquitectura general de MyConference.

La Web está basada en \textit{Express}, framework de desarrollo de aplicaciones web de \nameref{tech:nodejs}.

Como se comentó anteriormente, la función principal de la Web es la creación y el borrado de datos, además de la visualización de estos datos. Para poder realizar estas operaciones es necesario establecer conexiones con la API mediante llamadas HTTP.


La aplicación Web se divide en tres partes: archivos de configuración, rutas e interfaz gráfica.

\subsection{Archivos de configuración}

Los \textit{archivos de configuración} de la aplicación web se encargan de:
\begin{itemize}
    \item Configurar el módulo \textit{Winston} para usar logs en la aplicación.
    \item Configurar las sesiones de la aplicación.
    \item Configurar el módulo \textit{Node SASS} para que compile los archivos de \nameref{tech:sass} a CSS.
    \item Establecer como archivos estáticos los archivos del directorio \texttt{public}.
    \item Establecer \nameref{tech:jade} como motor para las vistas.
    \item Comprobar si los tokens de refresco han caducado.
    \item Enlazar las rutas de la aplicación, explicadas en la sección \ref{subsec:web-routes}
    \item Configurar el puerto en el que escucha la aplicación.
    \item Configurar el entorno de desarrollo, que puede ser producción o desarrollo.
    \item Configurar la base de datos MongoDB en función del entorno de desarrollo.
    \item Establecer la URL de la API en función del entorno de desarrollo.
    \item Configurar el módulo \textit{Restify}.
\end{itemize}

\subsection{Rutas}
\label{subsec:web-routes}

el directorio \textit{routes} es la que contiene todos los archivos con las llamadas HTTP a la API. Las llamadas están organizadas en diferentes archivos según los datos que se requieran.

Todos los archivos están enlazados desde los archivos de configuración.

\subsection{Interfaz Gráfica}

Todos los elementos de diseño se guardan en el directorio \texttt{public}. En esta carpeta se encuentran los archivos de CSS y JavaScript que requiere la aplicación.

Para la interfaz de usuario se han utilizado las siguientes librerías de apoyo:

\begin{description}
    \item[\nameref{tech:bootstrap} (Ver \ref{tech:bootstrap})] prácticamente todo el estilo de la página se ha podido hacer de manera fácil y rápida gracias a este framework, obteniendo un resultado sencillo y vistoso añadiendo unas pocas líneas de código.
    \item[\nameref{tech:googlemaps} (Ver \ref{tech:googlemaps})] usada para el mapa que permite visualizar los lugares añadidos para un congreso.
\end{description}

Fuera del directorio \texttt{public} está el directorio \texttt{sass}, que contiene todos los archivos \texttt{.scss} que usamos en la aplicación.
Esta carpeta está fuera del directorio \texttt{public} ya que realmente la aplicación no usa estos archivos para el diseño, solo los compila y los traduce a archivos CSS que se guardan dentro del directorio \texttt{public}. Estos archivos CSS son los que se usan realmente en la aplicación.
